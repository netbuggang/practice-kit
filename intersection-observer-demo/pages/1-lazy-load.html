<!DOCTYPE html>
<html lang="zh-CN">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>åœºæ™¯1ï¼šå›¾ç‰‡æ‡’åŠ è½½ | IntersectionObserver</title>
  <link rel="stylesheet" href="../css/style.css">
  <style>
    .image-grid {
      display: grid;
      grid-template-columns: repeat(auto-fill, minmax(200px, 1fr));
      gap: 1rem;
      margin: 2rem 0;
    }

    .lazy-image {
      width: 100%;
      height: 200px;
      object-fit: cover;
      border-radius: 8px;
      background: #e2e8f0;
      transition: opacity 0.3s;
      opacity: 0.3;
    }

    .lazy-image.loaded {
      opacity: 1;
    }

    .stats {
      background: #667eea;
      color: white;
      padding: 0.5rem 1rem;
      border-radius: 30px;
      display: inline-block;
      margin: 1rem 0;
    }
  </style>
</head>

<body>
  <div class="page-header">
    <a href="../index.html" class="back-link">â† è¿”å›ä¸»é¡µ</a>
    <h1>ğŸ“¸ åœºæ™¯1ï¼šå›¾ç‰‡æ‡’åŠ è½½</h1>
    <div style="width: 80px;"></div>
  </div>

  <div class="demo-container">
    <div class="explain">
      <strong>ğŸ’¡ åŸç†ï¼š</strong> å›¾ç‰‡çš„ src åˆå§‹è®¾ä¸ºå ä½å›¾æˆ–ç©ºï¼ŒçœŸæ­£çš„å›¾ç‰‡åœ°å€æ”¾åœ¨ data-src ä¸­ã€‚
      å½“å›¾ç‰‡è¿›å…¥è§†å£æ—¶ï¼Œç”¨ IntersectionObserver å°† data-src èµ‹ç»™ srcï¼Œè§¦å‘åŠ è½½ã€‚
    </div>

    <div class="stats" id="loadedStats">å·²åŠ è½½: 0 / 12 å¼ </div>

    <div class="image-grid" id="imageGrid"></div>

    <div
      style="height: 500px; background: linear-gradient(to bottom, #f1f5f9, #ffffff); display: flex; align-items: center; justify-content: center; border-radius: 12px; margin: 2rem 0;">
      â¬‡ï¸ ä¸‹æ–¹è¿˜æœ‰æ›´å¤šå›¾ç‰‡ï¼Œæ»šåŠ¨æŸ¥çœ‹æ‡’åŠ è½½æ•ˆæœ
    </div>

    <div class="image-grid" id="imageGrid2"></div>
  </div>

  <script>
    // ç”Ÿæˆå ä½å›¾ç‰‡æ•°æ®
    const generateImages = (start, count) => {
      return Array.from({ length: count }, (_, i) => ({
        id: start + i,
        src: `https://picsum.photos/400/300?random=${start + i}`,
        alt: `Random Image ${start + i}`
      }));
    };

    const images1 = generateImages(1, 12);
    const images2 = generateImages(13, 12);

    // æ¸²æŸ“å›¾ç‰‡ç½‘æ ¼
    const renderGrid = (containerId, images) => {
      const grid = document.getElementById(containerId);
      grid.innerHTML = images.map(img => `
                <div>
                    <img 
                        class="lazy-image" 
                        data-src="${img.src}" 
                        src="data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='400' height='300' viewBox='0 0 400 300'%3E%3Crect width='400' height='300' fill='%23e2e8f0'/%3E%3C/svg%3E"
                        alt="${img.alt}"
                        loading="lazy"
                    >
                </div>
            `).join('');
    };

    renderGrid('imageGrid', images1);
    renderGrid('imageGrid2', images2);

    // IntersectionObserver å®ç°
    const observer = new IntersectionObserver((entries) => {
      entries.forEach(entry => {
        if (entry.isIntersecting) {
          const img = entry.target;
          const src = img.dataset.src;

          if (src) {
            img.src = src;
            img.classList.add('loaded');
            observer.unobserve(img); // åŠ è½½ååœæ­¢è§‚å¯Ÿ

            // æ›´æ–°è®¡æ•°
            updateStats();
          }
        }
      });
    }, {
      rootMargin: '50px', // æå‰50pxåŠ è½½
      threshold: 0.01
    });

    // è§‚å¯Ÿæ‰€æœ‰æ‡’åŠ è½½å›¾ç‰‡
    document.querySelectorAll('.lazy-image').forEach(img => {
      observer.observe(img);
    });

    // ç»Ÿè®¡å·²åŠ è½½æ•°é‡
    function updateStats() {
      const loaded = document.querySelectorAll('.lazy-image.loaded').length;
      const total = document.querySelectorAll('.lazy-image').length;
      document.getElementById('loadedStats').textContent = `å·²åŠ è½½: ${loaded} / ${total} å¼ `;
    }

    // åˆå§‹ç»Ÿè®¡
    updateStats();
  </script>
</body>

</html>
