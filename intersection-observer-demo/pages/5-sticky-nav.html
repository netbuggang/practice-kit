<!DOCTYPE html>
<html lang="zh-CN">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>åœºæ™¯5ï¼šå¸é¡¶å¯¼èˆª | IntersectionObserver</title>
  <link rel="stylesheet" href="../css/style.css">
  <style>
    .demo-content {
      max-width: 800px;
      margin: 0 auto;
    }

    .section-header {
      height: 60px;
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      border-radius: 12px 12px 0 0;
      top: 0;
      z-index: 10;
      transition: all 0.3s;
    }

    .section-header.sticky {
      background: #1e293b;
      box-shadow: 0 4px 20px rgba(0, 0, 0, 0.2);
      transform: scale(1.02);
    }

    .section-header.sticky h2 {
      color: #667eea;
    }

    .section-header h2 {
      color: white;
      margin: 0;
      padding: 0 1.5rem;
      line-height: 60px;
      transition: color 0.3s;
    }

    .section-content {
      background: white;
      padding: 2rem;
      border-radius: 0 0 12px 12px;
      margin-bottom: 2rem;
      box-shadow: 0 4px 15px rgba(0, 0, 0, 0.05);
    }

    .nav-container {
      background: white;
      border-radius: 50px;
      padding: 0.8rem;
      margin-bottom: 2rem;
      box-shadow: 0 4px 20px rgba(0, 0, 0, 0.1);
      top: 20px;
      z-index: 100;
      transition: all 0.3s;
      backdrop-filter: blur(10px);
      border: 1px solid #e2e8f0;
    }

    .nav-container.sticky-nav {
      position: sticky;
      left: 0;
      right: 0;
      background: rgba(255, 255, 255, 0.95);
      backdrop-filter: blur(10px);
      box-shadow: 0 8px 30px rgba(102, 126, 234, 0.3);
      border-color: #667eea;
      transform: translateY(-5px);
    }

    .nav-links {
      display: flex;
      justify-content: center;
      gap: 2rem;
    }

    .nav-links a {
      text-decoration: none;
      color: #64748b;
      font-weight: 500;
      padding: 0.5rem 1rem;
      border-radius: 30px;
      transition: all 0.3s;
    }

    .nav-links a:hover {
      background: #f1f5f9;
      color: #667eea;
    }

    .nav-links a.active {
      background: #667eea;
      color: white;
    }

    .sentinel {
      height: 1px;
      visibility: hidden;
    }

    .sticky-indicator {
      position: fixed;
      bottom: 20px;
      left: 20px;
      background: #1e293b;
      color: white;
      padding: 0.5rem 1rem;
      border-radius: 30px;
      font-size: 0.9rem;
      box-shadow: 0 2px 10px rgba(0, 0, 0, 0.2);
      z-index: 1000;
      transition: opacity 0.3s;
    }

    .sticky-indicator.active {
      background: #667eea;
    }

    .progress-ring {
      position: fixed;
      bottom: 20px;
      right: 20px;
      width: 50px;
      height: 50px;
      background: white;
      border-radius: 50%;
      display: flex;
      align-items: center;
      justify-content: center;
      box-shadow: 0 2px 10px rgba(0, 0, 0, 0.2);
      font-weight: bold;
      color: #000;
      z-index: 1000;
    }
  </style>
</head>

<body>
  <div class="page-header">
    <a href="../index.html" class="back-link">â† è¿”å›ä¸»é¡µ</a>
    <h1>ğŸ“Œ åœºæ™¯5ï¼šå¸é¡¶å¯¼èˆª</h1>
    <div style="width: 80px;"></div>
  </div>

  <div class="demo-container">
    <div class="explain">
      <strong>ğŸ’¡ åŸç†ï¼š</strong> åœ¨å¯¼èˆªæ ä¸Šæ–¹æ”¾ç½®ä¸€ä¸ªå“¨å…µå…ƒç´ ï¼Œå½“å“¨å…µç¦»å¼€è§†å£æ—¶å¯¼èˆªæ å¸é¡¶ï¼›
      å½“å“¨å…µé‡æ–°è¿›å…¥è§†å£æ—¶å¯¼èˆªæ æ¢å¤åŸä½ã€‚å®ç°ç²¾å‡†çš„å¸é¡¶æ•ˆæœã€‚
    </div>

    <!-- å¸é¡¶çŠ¶æ€æŒ‡ç¤ºå™¨ -->
    <div class="sticky-indicator" id="stickyIndicator">å¯¼èˆªæ çŠ¶æ€: æ­£å¸¸</div>
    <div class="progress-ring" id="progressRing">0%</div>

    <!-- å“¨å…µå…ƒç´  - ç”¨äºè§¦å‘å¯¼èˆªå¸é¡¶ -->
    <div class="sentinel" id="navSentinel"></div>

    <!-- å¯¼èˆªæ  -->
    <div class="nav-container" id="mainNav">
      <div class="nav-links">
        <a href="#section1" class="active">ç¬¬ä¸€ç« </a>
        <a href="#section2">ç¬¬äºŒç« </a>
        <a href="#section3">ç¬¬ä¸‰ç« </a>
        <a href="#section4">ç¬¬å››ç« </a>
        <a href="#section5">ç¬¬äº”ç« </a>
      </div>
    </div>

    <div class="demo-content">
      <!-- ç« èŠ‚1 -->
      <section id="section1" class="section-header" data-sticky="header1">
        <h2>ğŸ“– ç¬¬ä¸€ç« ï¼šå¼•è¨€</h2>
      </section>
      <div class="section-content">
        <p style="font-size: 1.1rem; line-height: 1.8;">
          åœ¨Webå¼€å‘ä¸­ï¼Œå¸é¡¶å¯¼èˆªæ˜¯ä¸€ç§å¸¸è§çš„äº¤äº’æ¨¡å¼ã€‚å½“ç”¨æˆ·æ»šåŠ¨é¡µé¢æ—¶ï¼Œå¯¼èˆªæ ä¼šå¸é™„åœ¨é¡¶éƒ¨ï¼Œæ–¹ä¾¿ç”¨æˆ·éšæ—¶è·³è½¬åˆ°å…¶ä»–ç« èŠ‚ã€‚
        </p>
        <p>ä¼ ç»Ÿå®ç°ä¾èµ– scroll äº‹ä»¶å’Œ getBoundingClientRectï¼Œä½†è¿™ç§æ–¹å¼ä¼šå¯¼è‡´é¢‘ç¹çš„é‡æ’ï¼Œæ€§èƒ½è¾ƒå·®ã€‚IntersectionObserver æä¾›äº†æ›´ä¼˜é›…çš„è§£å†³æ–¹æ¡ˆã€‚</p>
        <div
          style="height:1000px; background: #f1f5f9; border-radius: 8px; margin: 1rem 0; display: flex; align-items: center; justify-content: center;">
          å†…å®¹åŒºåŸŸ
        </div>
      </div>

      <!-- ç« èŠ‚2 -->
      <section id="section2" class="section-header" data-sticky="header2">
        <h2>ğŸ”§ ç¬¬äºŒç« ï¼šå®ç°åŸç†</h2>
      </section>
      <div class="section-content">
        <p>IntersectionObserver å¯ä»¥å¼‚æ­¥è§‚å¯Ÿç›®æ ‡å…ƒç´ ä¸ç¥–å…ˆå…ƒç´ æˆ–é¡¶çº§æ–‡æ¡£è§†å£çš„äº¤å‰çŠ¶æ€ã€‚é€šè¿‡è§‚å¯Ÿå¯¼èˆªæ ä¸Šæ–¹çš„å“¨å…µå…ƒç´ ï¼Œæˆ‘ä»¬å¯ä»¥ç²¾ç¡®æ§åˆ¶å¯¼èˆªæ çš„å¸é¡¶çŠ¶æ€ã€‚</p>
        <ul style="margin-left: 2rem; margin-top: 1rem;">
          <li>å“¨å…µè¿›å…¥è§†å£ â†’ å¯¼èˆªæ æ¢å¤æ­£å¸¸</li>
          <li>å“¨å…µç¦»å¼€è§†å£ â†’ å¯¼èˆªæ å¸é¡¶</li>
        </ul>
        <div
          style="height:1000px; background: #f1f5f9; border-radius: 8px; margin: 1rem 0; display: flex; align-items: center; justify-content: center;">
          ä»£ç ç¤ºä¾‹åŒºåŸŸ
        </div>
      </div>

      <!-- ç« èŠ‚3 -->
      <section id="section3" class="section-header" data-sticky="header3">
        <h2>âš¡ ç¬¬ä¸‰ç« ï¼šæ€§èƒ½ä¼˜åŠ¿</h2>
      </section>
      <div class="section-content">
        <p>ç›¸æ¯”ä¼ ç»Ÿçš„ scroll ç›‘å¬æ–¹å¼ï¼ŒIntersectionObserver æœ‰ä»¥ä¸‹ä¼˜åŠ¿ï¼š</p>
        <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 1rem; margin-top: 1rem;">
          <div style="background: #f1f5f9; padding: 1rem; border-radius: 8px;">
            <h4 style="color: #ef4444;">ä¼ ç»Ÿæ–¹å¼ âŒ</h4>
            <ul style="margin-left: 1.5rem;">
              <li>ä¸»çº¿ç¨‹é˜»å¡</li>
              <li>é¢‘ç¹é‡æ’</li>
              <li>æ— æ³•èŠ‚æµä¼˜åŒ–</li>
            </ul>
          </div>
          <div style="background: #f1f5f9; padding: 1rem; border-radius: 8px;">
            <h4 style="color: #22c55e;">Observeræ–¹å¼ âœ…</h4>
            <ul style="margin-left: 1.5rem;">
              <li>å¼‚æ­¥éé˜»å¡</li>
              <li>æ— éœ€è®¡ç®—ä½ç½®</li>
              <li>ç²¾å‡†é˜ˆå€¼æ§åˆ¶</li>
            </ul>
          </div>
        </div>
        <div style="height:1000px; background: #f1f5f9; border-radius: 8px; margin: 1rem 0;"></div>
      </div>

      <!-- ç« èŠ‚4 -->
      <section id="section4" class="section-header" data-sticky="header4">
        <h2>ğŸ¨ ç¬¬å››ç« ï¼šè¿›é˜¶ç”¨æ³•</h2>
      </section>
      <div class="section-content">
        <p>é™¤äº†åŸºæœ¬çš„å¸é¡¶æ•ˆæœï¼Œè¿˜å¯ä»¥ç»“åˆå…¶ä»–ç‰¹æ€§ï¼š</p>
        <ul style="margin: 1rem 0 1rem 2rem;">
          <li>åŠ¨æ€æ”¹å˜å¯¼èˆªæ ·å¼</li>
          <li>é«˜äº®å½“å‰ç« èŠ‚</li>
          <li>æ˜¾ç¤ºé˜…è¯»è¿›åº¦</li>
          <li>è¿”å›é¡¶éƒ¨æŒ‰é’®</li>
        </ul>
        <div style="height:1000px; background: #f1f5f9; border-radius: 8px; margin: 1rem 0;"></div>
      </div>

      <!-- ç« èŠ‚5 -->
      <section id="section5" class="section-header" data-sticky="header5">
        <h2>ğŸ“ ç¬¬äº”ç« ï¼šæ€»ç»“</h2>
      </section>
      <div class="section-content">
        <p>IntersectionObserver ä¸ºå®ç°å¸é¡¶å¯¼èˆªæä¾›äº†ä¼˜é›…çš„è§£å†³æ–¹æ¡ˆï¼Œå…·æœ‰æ€§èƒ½å¥½ã€ä»£ç ç®€æ´ã€æ§åˆ¶ç²¾å‡†ç­‰ä¼˜ç‚¹ã€‚æ˜¯ç°ä»£Webå¼€å‘ä¸­å¤„ç†æ»šåŠ¨ç›¸å…³éœ€æ±‚çš„åˆ©å™¨ã€‚</p>
        <div style="background: #e9eef4; padding: 1.5rem; border-radius: 8px; margin-top: 1rem;">
          <strong>âœ¨ å°æŠ€å·§ï¼š</strong> å¯ä»¥ç»“åˆ CSS position: sticky å®ç°æ›´ç®€å•çš„å¸é¡¶æ•ˆæœï¼Œä½† IntersectionObserver èƒ½æä¾›æ›´ç²¾ç»†çš„æ§åˆ¶ã€‚
        </div>
      </div>

      <!-- åº•éƒ¨ç•™ç™½ -->
      <div
        style="height:1000px; background: linear-gradient(to bottom, #f1f5f9, #ffffff); border-radius: 12px; margin: 2rem 0; display: flex; align-items: center; justify-content: center;">
        ğŸ å·²ç»åˆ°åº•äº†
      </div>
    </div>
  </div>

  <script>
    // è·å–å…ƒç´ 
    const sentinel = document.getElementById('navSentinel');
    const nav = document.getElementById('mainNav');
    const indicator = document.getElementById('stickyIndicator');
    const progressRing = document.getElementById('progressRing');
    const navLinks = document.querySelectorAll('.nav-links a');
    const sections = document.querySelectorAll('.section-header');

    // å¯¼èˆªå¸é¡¶è§‚å¯Ÿå™¨
    const navObserver = new IntersectionObserver((entries) => {
      entries.forEach(entry => {
        if (entry.isIntersecting) {
          // å“¨å…µå¯è§ â†’ å¯¼èˆªæ¢å¤æ­£å¸¸
          nav.classList.remove('sticky-nav');
          indicator.textContent = 'å¯¼èˆªæ çŠ¶æ€: æ­£å¸¸';
          indicator.classList.remove('active');
        } else {
          // å“¨å…µä¸å¯è§ â†’ å¯¼èˆªå¸é¡¶
          nav.classList.add('sticky-nav');
          indicator.textContent = 'å¯¼èˆªæ çŠ¶æ€: å¸é¡¶';
          indicator.classList.add('active');
        }
      });
    }, {
      threshold: 0,
      rootMargin: '-1px 0px 0px 0px' // å¾®è°ƒè§¦å‘è¾¹ç•Œ
    });

    navObserver.observe(sentinel);

    // ç« èŠ‚é«˜äº®è§‚å¯Ÿå™¨
    const sectionObserver = new IntersectionObserver((entries) => {
      entries.forEach(entry => {
        if (entry.isIntersecting) {
          const id = entry.target.id;
          // ç§»é™¤æ‰€æœ‰activeç±»
          navLinks.forEach(link => link.classList.remove('active'));
          // ä¸ºå¯¹åº”é“¾æ¥æ·»åŠ activeç±»
          const activeLink = document.querySelector(`.nav-links a[href="#${id}"]`);
          if (activeLink) {
            activeLink.classList.add('active');
          }
        }
      });
    }, {
      threshold: 0.5,
      rootMargin: '-100px 0px -100px 0px' // è°ƒæ•´è§¦å‘åŒºåŸŸ
    });

    // è§‚å¯Ÿæ‰€æœ‰ç« èŠ‚
    sections.forEach(section => {
      sectionObserver.observe(section);
    });

    // é˜…è¯»è¿›åº¦è®¡ç®—
    function updateProgress() {
      const scrollTop = window.scrollY;
      const windowHeight = window.innerHeight;
      const documentHeight = document.documentElement.scrollHeight;

      const maxScroll = documentHeight - windowHeight;
      const progress = Math.round((scrollTop / maxScroll) * 100);

      progressRing.textContent = `${progress}%`;

      // æ¸å˜åœ†ç¯æ•ˆæœ
      const degree = (progress / 100) * 360;
      progressRing.style.background = `conic-gradient(#667eea 0deg, #667eea ${degree}deg, white ${degree}deg, white 360deg)`;
    }

    window.addEventListener('scroll', updateProgress);
    updateProgress();

    // ç‚¹å‡»å¯¼èˆªå¹³æ»‘æ»šåŠ¨
    navLinks.forEach(link => {
      link.addEventListener('click', (e) => {
        e.preventDefault();
        const targetId = link.getAttribute('href');
        const targetSection = document.querySelector(targetId);

        if (targetSection) {
          // è·å–å¯¼èˆªæ é«˜åº¦
          const navHeight = document.getElementById('mainNav').offsetHeight;
          const extraOffset = 20; // é¢å¤–ç•™ç™½ 20px

          const elementPosition = targetSection.getBoundingClientRect().top;
          const offsetPosition = elementPosition + window.pageYOffset - navHeight - extraOffset;

          window.scrollTo({
            top: offsetPosition,
            behavior: 'smooth'
          });
        }
      });
    });

    // ç« èŠ‚å¸é¡¶æ•ˆæœï¼ˆç‹¬ç«‹äºå¯¼èˆªï¼‰
    // const headerObserver = new IntersectionObserver((entries) => {
    //     entries.forEach(entry => {
    //         if (entry.target.classList.contains('section-header')) {
    //             if (!entry.isIntersecting) {
    //                 entry.target.classList.add('sticky');
    //             } else {
    //                 entry.target.classList.remove('sticky');
    //             }
    //         }
    //     });
    // }, {
    //     threshold: 0,
    //     rootMargin: '-60px 0px 0px 0px'
    // });

    // document.querySelectorAll('.section-header').forEach(header => {
    //     headerObserver.observe(header);
    // });
  </script>
</body>

</html>
