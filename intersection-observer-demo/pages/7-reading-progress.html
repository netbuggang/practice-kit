<!DOCTYPE html>
<html lang="zh-CN">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>åœºæ™¯7ï¼šé˜…è¯»è¿›åº¦æŒ‡ç¤ºå™¨ | IntersectionObserver</title>
  <link rel="stylesheet" href="../css/style.css">
  <style>
    .article-container {
      max-width: 800px;
      margin: 0 auto;
      background: white;
      border-radius: 24px;
      padding: 3rem;
      box-shadow: 0 20px 40px rgba(0, 0, 0, 0.08);
      position: relative;
    }

    .article-title {
      font-size: 2.5rem;
      color: #1e293b;
      margin-bottom: 1rem;
      line-height: 1.3;
    }

    .article-meta {
      color: #94a3b8;
      margin-bottom: 2rem;
      padding-bottom: 2rem;
      border-bottom: 2px solid #f1f5f9;
      display: flex;
      gap: 2rem;
    }

    .article-content {
      font-size: 1.1rem;
      line-height: 1.8;
      color: #334155;
    }

    .article-content p {
      margin-bottom: 1.5rem;
    }

    .article-content h2 {
      font-size: 1.8rem;
      margin: 2.5rem 0 1rem;
      color: #1e293b;
    }

    .article-content blockquote {
      background: #f8fafc;
      border-left: 4px solid #667eea;
      padding: 1.5rem;
      margin: 2rem 0;
      border-radius: 0 12px 12px 0;
      font-style: italic;
      color: #475569;
    }

    /* é¡¶éƒ¨è¿›åº¦æ¡ */
    .progress-bar-top {
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 4px;
      background: #e2e8f0;
      z-index: 1001;
    }

    .progress-fill {
      height: 100%;
      background: linear-gradient(90deg, #667eea, #764ba2);
      width: 0%;
      transition: width 0.1s ease;
    }

    /* åœ†å½¢è¿›åº¦æŒ‡ç¤ºå™¨ */
    .progress-circle {
      position: fixed;
      bottom: 30px;
      right: 30px;
      width: 60px;
      height: 60px;
      border-radius: 50%;
      background: white;
      box-shadow: 0 4px 20px rgba(0, 0, 0, 0.15);
      display: flex;
      align-items: center;
      justify-content: center;
      font-weight: bold;
      color: #667eea;
      z-index: 1000;
      cursor: pointer;
      transition: transform 0.3s;
    }

    .progress-circle:hover {
      transform: scale(1.1);
    }

    .progress-circle svg {
      width: 70px;
      height: 70px;
      position: absolute;
    }

    .progress-circle circle {
      fill: none;
      stroke: #667eea;
      stroke-width: 4;
      stroke-linecap: round;
      transform: rotate(-90deg);
      transform-origin: 50% 50%;
      transition: stroke-dashoffset 0.3s;
    }

    .progress-circle-bg {
      stroke: #e2e8f0;
      stroke-width: 4;
    }

    .progress-text {
      position: relative;
      z-index: 1;
    }

    /* ç« èŠ‚æ ‡è®° */
    .section-marker {
      position: sticky;
      top: 20px;
      left: 0;
      background: #f1f5f9;
      padding: 0.5rem 1rem;
      border-radius: 30px;
      font-size: 0.9rem;
      color: #475569;
      margin-bottom: 1rem;
      display: inline-block;
      transition: all 0.3s;
      border: 1px solid #e2e8f0;
    }

    .section-marker.active {
      background: #667eea;
      color: white;
      border-color: #667eea;
    }

    /* é˜…è¯»è¿›åº¦å¡ç‰‡ */
    .reading-stats {
      position: fixed;
      bottom: 30px;
      left: 30px;
      background: white;
      padding: 1rem 1.5rem;
      border-radius: 40px;
      box-shadow: 0 4px 20px rgba(0, 0, 0, 0.1);
      display: flex;
      gap: 2rem;
      z-index: 1000;
      font-size: 0.9rem;
      border: 1px solid #e2e8f0;
    }

    .stat-item {
      display: flex;
      align-items: center;
      gap: 0.5rem;
    }

    .stat-dot {
      width: 8px;
      height: 8px;
      border-radius: 50%;
      background: #667eea;
    }

    .stat-dot.read {
      background: #22c55e;
    }

    /* è¿”å›é¡¶éƒ¨æŒ‰é’® */
    .back-to-top {
      position: fixed;
      bottom: 100px;
      right: 30px;
      width: 40px;
      height: 40px;
      background: white;
      border-radius: 50%;
      box-shadow: 0 4px 10px rgba(0, 0, 0, 0.1);
      display: flex;
      align-items: center;
      justify-content: center;
      cursor: pointer;
      opacity: 0;
      transition: opacity 0.3s, transform 0.3s;
      z-index: 999;
      border: 1px solid #e2e8f0;
    }

    .back-to-top.visible {
      opacity: 1;
    }

    .back-to-top:hover {
      transform: translateY(-5px);
      background: #667eea;
      color: white;
      border-color: #667eea;
    }
  </style>
</head>

<body>
  <div class="page-header">
    <a href="../index.html" class="back-link">â† è¿”å›ä¸»é¡µ</a>
    <h1>ğŸ“ˆ åœºæ™¯7ï¼šé˜…è¯»è¿›åº¦æŒ‡ç¤ºå™¨</h1>
    <div style="width: 80px;"></div>
  </div>

  <!-- é¡¶éƒ¨è¿›åº¦æ¡ -->
  <div class="progress-bar-top">
    <div class="progress-fill" id="progressBar"></div>
  </div>

  <!-- åœ†å½¢è¿›åº¦æŒ‡ç¤ºå™¨ -->
  <div class="progress-circle" id="progressCircle" onclick="scrollToTop()">
    <svg viewBox="0 0 100 100">
      <circle class="progress-circle-bg" cx="50" cy="50" r="46" />
      <circle class="progress-circle-fill" cx="50" cy="50" r="46" id="progressCircleFill" />
    </svg>
    <span class="progress-text" id="progressPercent">0%</span>
  </div>

  <!-- é˜…è¯»ç»Ÿè®¡å¡ç‰‡ -->
  <div class="reading-stats">
    <div class="stat-item">
      <span class="stat-dot"></span>
      <span id="sectionRead">0/8 ç« èŠ‚</span>
    </div>
    <div class="stat-item">
      <span>â±ï¸</span>
      <span id="readTime">0 min</span>
    </div>
  </div>

  <!-- è¿”å›é¡¶éƒ¨æŒ‰é’® -->
  <div class="back-to-top" id="backToTop" onclick="scrollToTop()">
    â†‘
  </div>

  <div class="demo-container">
    <div class="explain">
      <strong>ğŸ’¡ åŸç†ï¼š</strong> é€šè¿‡ IntersectionObserver ç›‘æµ‹æ–‡ç« å„ç« èŠ‚çš„å¯è§æ€§ï¼Œ
      ç»“åˆæ»šåŠ¨ä½ç½®è®¡ç®—é˜…è¯»è¿›åº¦ã€‚æä¾›å¤šç§è¿›åº¦å±•ç¤ºæ–¹å¼ï¼šé¡¶éƒ¨è¿›åº¦æ¡ã€åœ†å½¢è¿›åº¦ã€ç« èŠ‚è®¡æ•°ã€‚
    </div>

    <div class="article-container">
      <h1 class="article-title">IntersectionObserver å®Œå…¨æŒ‡å—</h1>

      <div class="article-meta">
        <span>ğŸ‘¤ ä½œè€…ï¼šDeepSeek</span>
        <span>ğŸ“… å‘å¸ƒæ—¥æœŸï¼š2026-02-12</span>
        <span>â±ï¸ é˜…è¯»æ—¶é•¿ï¼š8åˆ†é’Ÿ</span>
      </div>

      <!-- ç« èŠ‚1 -->
      <div class="section-marker" id="section-marker-1">ğŸ“– ç¬¬ä¸€ç« ï¼šç®€ä»‹</div>
      <section id="section1" class="article-content">
        <h2>1. ä»€ä¹ˆæ˜¯ IntersectionObserverï¼Ÿ</h2>
        <p>IntersectionObserver æ˜¯ç°ä»£æµè§ˆå™¨æä¾›çš„ä¸€ä¸ª APIï¼Œç”¨äºå¼‚æ­¥è§‚å¯Ÿç›®æ ‡å…ƒç´ ä¸ç¥–å…ˆå…ƒç´ æˆ–é¡¶çº§æ–‡æ¡£è§†å£çš„äº¤å‰çŠ¶æ€ã€‚ç®€å•æ¥è¯´ï¼Œå®ƒèƒ½å¤Ÿæ£€æµ‹ä¸€ä¸ªå…ƒç´ æ˜¯å¦å‡ºç°åœ¨è§†å£ä¸­ï¼Œæˆ–è€…å‡ºç°åœ¨è§†å£çš„ä»€ä¹ˆä½ç½®ã€‚</p>
        <p>åœ¨è¿‡å»ï¼Œæˆ‘ä»¬é€šå¸¸é€šè¿‡ç›‘å¬ scroll äº‹ä»¶å¹¶è°ƒç”¨ getBoundingClientRect() æ¥å®ç°ç±»ä¼¼çš„åŠŸèƒ½ã€‚ä½†è¿™ç§åšæ³•æœ‰å‡ ä¸ªç¼ºç‚¹ï¼š</p>
        <ul>
          <li>scroll äº‹ä»¶è§¦å‘é¢‘ç¹ï¼Œå®¹æ˜“é€ æˆæ€§èƒ½é—®é¢˜</li>
          <li>getBoundingClientRect() ä¼šå¼•èµ·é‡æ’</li>
          <li>ä»£ç å¤æ‚ï¼Œéœ€è¦æ‰‹åŠ¨è®¡ç®—ä½ç½®</li>
        </ul>
        <p>IntersectionObserver è§£å†³äº†è¿™äº›é—®é¢˜ï¼Œå®ƒæä¾›äº†å£°æ˜å¼çš„æ–¹å¼ï¼Œå¼‚æ­¥æ‰§è¡Œï¼Œä¸ä¼šé˜»å¡ä¸»çº¿ç¨‹ã€‚</p>
        <blockquote>
          "IntersectionObserver æ˜¯ç°ä»£å‰ç«¯æ€§èƒ½ä¼˜åŒ–çš„åˆ©å™¨ï¼Œç‰¹åˆ«é€‚åˆå®ç°æ‡’åŠ è½½ã€æ— é™æ»šåŠ¨ã€æ›å…‰ç»Ÿè®¡ç­‰åŠŸèƒ½ã€‚"
        </blockquote>
      </section>

      <!-- ç« èŠ‚2 -->
      <div class="section-marker" id="section-marker-2">ğŸ”§ ç¬¬äºŒç« ï¼šåŸºæœ¬ç”¨æ³•</div>
      <section id="section2" class="article-content">
        <h2>2. åŸºæœ¬ç”¨æ³•ä¸é…ç½®</h2>
        <p>åˆ›å»ºä¸€ä¸ª IntersectionObserver å®ä¾‹éå¸¸ç®€å•ï¼š</p>
        <pre style="background: #f1f5f9; padding: 1rem; border-radius: 8px; overflow-x: auto;">
const observer = new IntersectionObserver((entries) => {
  entries.forEach(entry => {
    if (entry.isIntersecting) {
      console.log('å…ƒç´ è¿›å…¥è§†å£');
    }
  });
}, {
  root: null, // é»˜è®¤ä¸ºæµè§ˆå™¨è§†å£
  rootMargin: '0px',
  threshold: 0.5 // 50% å¯è§æ—¶è§¦å‘
});

observer.observe(targetElement);</pre>
        <p>é…ç½®é¡¹è¯´æ˜ï¼š</p>
        <ul>
          <li><strong>root</strong>: ç”¨ä½œè§†å£çš„å…ƒç´ ï¼Œé»˜è®¤ä¸ºæµè§ˆå™¨è§†å£</li>
          <li><strong>rootMargin</strong>: æ‰©å¤§æˆ–ç¼©å°è§†å£åŒºåŸŸ</li>
          <li><strong>threshold</strong>: è§¦å‘å›è°ƒçš„é˜ˆå€¼ï¼Œå¯ä»¥æ˜¯0-1ä¹‹é—´çš„æ•°å€¼æˆ–æ•°ç»„</li>
        </ul>
      </section>

      <!-- ç« èŠ‚3 -->
      <div class="section-marker" id="section-marker-3">âš¡ ç¬¬ä¸‰ç« ï¼šæ€§èƒ½ä¼˜åŠ¿</div>
      <section id="section3" class="article-content">
        <h2>3. æ€§èƒ½å¯¹æ¯”ä¸ä¼ ç»Ÿæ–¹æ¡ˆ</h2>
        <p>è®©æˆ‘ä»¬å¯¹æ¯”ä¸€ä¸‹ä¼ ç»Ÿæ–¹æ¡ˆå’Œ IntersectionObserver çš„æ€§èƒ½å·®å¼‚ï¼š</p>

        <h3>ä¼ ç»Ÿ scroll æ–¹æ¡ˆ</h3>
        <pre style="background: #f1f5f9; padding: 1rem; border-radius: 8px;">
window.addEventListener('scroll', () => {
  const rect = element.getBoundingClientRect();
  if (rect.top < window.innerHeight) {
    // å…ƒç´ è¿›å…¥è§†å£
  }
});</pre>

        <p>è¿™ç§æ–¹æ¡ˆçš„é—®é¢˜ï¼š</p>
        <ul>
          <li>æ¯æ¬¡æ»šåŠ¨éƒ½ä¼šè§¦å‘</li>
          <li>getBoundingClientRect å¼ºåˆ¶åŒæ­¥å¸ƒå±€</li>
          <li>æ— æ³•ç²¾ç¡®æ§åˆ¶è§¦å‘æ—¶æœº</li>
        </ul>

        <h3>IntersectionObserver æ–¹æ¡ˆ</h3>
        <ul>
          <li>å¼‚æ­¥æ‰§è¡Œï¼Œä¸é˜»å¡ä¸»çº¿ç¨‹</li>
          <li>æµè§ˆå™¨ä¼˜åŒ–ï¼Œæ‰¹é‡å¤„ç†</li>
          <li>ç²¾ç¡®æ§åˆ¶é˜ˆå€¼</li>
        </ul>
      </section>

      <!-- ç« èŠ‚4 -->
      <div class="section-marker" id="section-marker-4">ğŸ¯ ç¬¬å››ç« ï¼šé«˜çº§ç”¨æ³•</div>
      <section id="section4" class="article-content">
        <h2>4. é«˜çº§ç‰¹æ€§ä¸æŠ€å·§</h2>

        <h3>4.1 å¤šé˜ˆå€¼ç›‘å¬</h3>
        <pre style="background: #f1f5f9; padding: 1rem; border-radius: 8px;">
const observer = new IntersectionObserver(callback, {
  threshold: [0, 0.25, 0.5, 0.75, 1]
});</pre>

        <h3>4.2 åŠ¨æ€ rootMargin</h3>
        <p>é€šè¿‡è®¾ç½®è´Ÿå€¼çš„ rootMarginï¼Œå¯ä»¥å®ç°å…ƒç´ å³å°†è¿›å…¥è§†å£æ—¶æå‰åŠ è½½ï¼š</p>
        <pre style="background: #f1f5f9; padding: 1rem; border-radius: 8px;">
const observer = new IntersectionObserver(callback, {
  rootMargin: '200px 0px' // æå‰200pxè§¦å‘
});</pre>

        <h3>4.3 è§‚å¯Ÿå¤šä¸ªå…ƒç´ </h3>
        <p>ä¸€ä¸ª observer å¯ä»¥è§‚å¯Ÿä»»æ„æ•°é‡çš„å…ƒç´ ï¼Œæµè§ˆå™¨ä¼šè‡ªåŠ¨æ‰¹é‡å¤„ç†ã€‚</p>
      </section>

      <!-- ç« èŠ‚5 -->
      <div class="section-marker" id="section-marker-5">ğŸ“Š ç¬¬äº”ç« ï¼šå®é™…åº”ç”¨</div>
      <section id="section5" class="article-content">
        <h2>5. ä¸ƒå¤§åº”ç”¨åœºæ™¯è¯¦è§£</h2>

        <h3>5.1 å›¾ç‰‡æ‡’åŠ è½½</h3>
        <p>å½“å›¾ç‰‡è¿›å…¥è§†å£æ—¶ï¼Œå°† data-src æ›¿æ¢ä¸º srcï¼Œè§¦å‘åŠ è½½ã€‚</p>

        <h3>5.2 æ— é™æ»šåŠ¨</h3>
        <p>åœ¨åˆ—è¡¨åº•éƒ¨æ”¾ç½®å“¨å…µå…ƒç´ ï¼Œå½“å“¨å…µè¿›å…¥è§†å£æ—¶åŠ è½½æ›´å¤šã€‚</p>

        <h3>5.3 åŠ¨ç”»è§¦å‘</h3>
        <p>å…ƒç´ è¿›å…¥è§†å£æ—¶æ·»åŠ åŠ¨ç”»ç±»ï¼Œäº§ç”Ÿå…¥åœºæ•ˆæœã€‚</p>

        <h3>5.4 å¹¿å‘Šç»Ÿè®¡</h3>
        <p>ç²¾å‡†ç»Ÿè®¡å¹¿å‘Šæ›å…‰æ¬¡æ•°ï¼Œç¡®ä¿è®¡è´¹å‡†ç¡®æ€§ã€‚</p>

        <h3>5.5 å¸é¡¶å¯¼èˆª</h3>
        <p>é€šè¿‡å“¨å…µå…ƒç´ æ§åˆ¶å¯¼èˆªæ çš„å¸é¡¶çŠ¶æ€ã€‚</p>

        <h3>5.6 è§†é¢‘è‡ªåŠ¨æ’­æ”¾</h3>
        <p>è§†é¢‘è¿›å…¥è§†å£æ—¶è‡ªåŠ¨æ’­æ”¾ï¼Œç¦»å¼€æ—¶æš‚åœã€‚</p>

        <h3>5.7 é˜…è¯»è¿›åº¦</h3>
        <p>ç»Ÿè®¡å„ç« èŠ‚é˜…è¯»æƒ…å†µï¼Œå±•ç¤ºé˜…è¯»è¿›åº¦ï¼ˆå½“å‰åœºæ™¯ï¼‰ã€‚</p>
      </section>

      <!-- ç« èŠ‚6 -->
      <div class="section-marker" id="section-marker-6">ğŸ“± ç¬¬å…­ç« ï¼šå…¼å®¹æ€§</div>
      <section id="section6" class="article-content">
        <h2>6. æµè§ˆå™¨å…¼å®¹æ€§ä¸é™çº§</h2>
        <p>IntersectionObserver æ”¯æŒæ‰€æœ‰ç°ä»£æµè§ˆå™¨ï¼ŒåŒ…æ‹¬ Chrome 51+ã€Firefox 55+ã€Safari 12.1+ã€Edge 15+ã€‚</p>

        <h3>é™çº§æ–¹æ¡ˆ</h3>
        <pre style="background: #f1f5f9; padding: 1rem; border-radius: 8px;">
if ('IntersectionObserver' in window) {
  // ä½¿ç”¨ IntersectionObserver
} else {
  // ä½¿ç”¨ä¼ ç»Ÿçš„ scroll äº‹ä»¶
  window.addEventListener('scroll', throttle(checkVisibility));
}</pre>

        <p>ä¹Ÿå¯ä»¥ä½¿ç”¨å®˜æ–¹ polyfillï¼š<code>npm install intersection-observer</code></p>
      </section>

      <!-- ç« èŠ‚7 -->
      <div class="section-marker" id="section-marker-7">âœ¨ ç¬¬ä¸ƒç« ï¼šæœ€ä½³å®è·µ</div>
      <section id="section7" class="article-content">
        <h2>7. æœ€ä½³å®è·µä¸æ€§èƒ½ä¼˜åŒ–</h2>
        <ul>
          <li><strong>åˆç†è®¾ç½®é˜ˆå€¼</strong>ï¼šæ ¹æ®å®é™…éœ€æ±‚é€‰æ‹©åˆé€‚çš„é˜ˆå€¼ï¼Œé¿å…è¿‡äºæ•æ„Ÿ</li>
          <li><strong>åŠæ—¶å–æ¶ˆè§‚å¯Ÿ</strong>ï¼šå…ƒç´ å®Œæˆä½¿å‘½åè°ƒç”¨ unobserve</li>
          <li><strong>ä½¿ç”¨ rootMargin é¢„åŠ è½½</strong>ï¼šæå‰åŠ è½½æå‡ä½“éªŒ</li>
          <li><strong>é¿å…åœ¨å›è°ƒä¸­æ‰§è¡Œé‡æ“ä½œ</strong>ï¼šå›è°ƒåº”å°½é‡è½»é‡</li>
          <li><strong>ç»“åˆ requestIdleCallback</strong>ï¼šéç´§æ€¥æ“ä½œåœ¨ç©ºé—²æ—¶æ‰§è¡Œ</li>
        </ul>
      </section>

      <!-- ç« èŠ‚8 -->
      <div class="section-marker" id="section-marker-8">ğŸ“ ç¬¬å…«ç« ï¼šæ€»ç»“</div>
      <section id="section8" class="article-content">
        <h2>8. æ€»ç»“</h2>
        <p>IntersectionObserver æ˜¯ç°ä»£å‰ç«¯å¼€å‘ä¸­ä¸å¯æˆ–ç¼ºçš„ APIï¼Œå®ƒè®©åŸæœ¬å¤æ‚çš„è§†å£æ£€æµ‹å˜å¾—ç®€å•é«˜æ•ˆã€‚é€šè¿‡æœ¬æ–‡çš„ä¸ƒä¸ªåœºæ™¯ï¼Œç›¸ä¿¡ä½ å·²ç»æŒæ¡äº†å®ƒçš„æ ¸å¿ƒç”¨æ³•ã€‚</p>
        <p>åœ¨å®é™…é¡¹ç›®ä¸­ï¼Œåˆç†è¿ç”¨ IntersectionObserver å¯ä»¥å¤§å¹…æå‡æ€§èƒ½ï¼Œæ”¹å–„ç”¨æˆ·ä½“éªŒã€‚å»ºè®®å°†å®ƒä½œä¸ºå‰ç«¯æ€§èƒ½ä¼˜åŒ–çš„æ ‡é…å·¥å…·ã€‚</p>

        <div
          style="background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); color: white; padding: 2rem; border-radius: 12px; margin-top: 2rem;">
          <h3 style="color: white;">ğŸ‰ æ­å–œä½ è¯»å®Œäº†å…¨æ–‡ï¼</h3>
          <p>ä½ å·²é˜…è¯» 8 ä¸ªç« èŠ‚ï¼ŒæŒæ¡äº† IntersectionObserver çš„æ ¸å¿ƒçŸ¥è¯†ã€‚</p>
        </div>
      </section>
    </div>
  </div>

  <script>
    // è·å–æ‰€æœ‰ç« èŠ‚
    const sections = document.querySelectorAll('section[id]');
    const markers = document.querySelectorAll('.section-marker');
    let startTime = Date.now();
    let readSections = new Set();

    // åœ†å½¢è¿›åº¦æ¡
    const circle = document.getElementById('progressCircleFill');
    const progressBar = document.getElementById('progressBar');
    const progressPercent = document.getElementById('progressPercent');
    const backToTop = document.getElementById('backToTop');
    const sectionReadEl = document.getElementById('sectionRead');
    const readTimeEl = document.getElementById('readTime');

    // è®¡ç®—åœ†å½¢è¿›åº¦æ¡çš„å‘¨é•¿
    const radius = 46;
    const circumference = 2 * Math.PI * radius;
    circle.style.strokeDasharray = `${circumference}`;
    circle.style.strokeDashoffset = `${circumference}`;

    // æ›´æ–°é˜…è¯»è¿›åº¦
    function updateProgress() {
      const scrollTop = window.scrollY;
      const windowHeight = window.innerHeight;
      const documentHeight = document.documentElement.scrollHeight;

      const maxScroll = documentHeight - windowHeight;
      const progress = Math.round((scrollTop / maxScroll) * 100);

      // æ›´æ–°é¡¶éƒ¨è¿›åº¦æ¡
      progressBar.style.width = `${progress}%`;

      // æ›´æ–°åœ†å½¢è¿›åº¦æ¡
      const offset = circumference - (progress / 100) * circumference;
      circle.style.strokeDashoffset = offset;
      progressPercent.textContent = `${progress}%`;

      // æ˜¾ç¤º/éšè—è¿”å›é¡¶éƒ¨æŒ‰é’®
      if (scrollTop > 500) {
        backToTop.classList.add('visible');
      } else {
        backToTop.classList.remove('visible');
      }

      // æ›´æ–°é˜…è¯»æ—¶é—´
      const elapsed = Math.floor((Date.now() - startTime) / 60000); // åˆ†é’Ÿ
      readTimeEl.textContent = `${elapsed} min`;
    }

    // IntersectionObserver è§‚å¯Ÿç« èŠ‚
    const sectionObserver = new IntersectionObserver((entries) => {
      entries.forEach(entry => {
        const index = Array.from(sections).indexOf(entry.target);

        if (entry.isIntersecting) {
          // ç« èŠ‚è¿›å…¥è§†å£
          readSections.add(entry.target.id);

          // é«˜äº®å¯¹åº”çš„ç« èŠ‚æ ‡è®°
          markers.forEach((marker, i) => {
            if (i === index) {
              marker.classList.add('active');
            }
          });

          // ç« èŠ‚æ ‡è®°æœ‰ç‰¹æ®Šæ ·å¼
          entry.target.style.opacity = '1';
        } else {
          // ç« èŠ‚ç¦»å¼€è§†å£
          markers.forEach((marker, i) => {
            if (i === index) {
              marker.classList.remove('active');
            }
          });
        }

        // æ›´æ–°å·²è¯»ç« èŠ‚ç»Ÿè®¡
        sectionReadEl.textContent = `${readSections.size}/${sections.length} ç« èŠ‚`;
      });
    }, {
      threshold: 0.3,
      rootMargin: '-20px 0px -20px 0px'
    });

    // è§‚å¯Ÿæ‰€æœ‰ç« èŠ‚
    sections.forEach(section => {
      sectionObserver.observe(section);
    });

    // ç›‘å¬æ»šåŠ¨æ›´æ–°è¿›åº¦
    window.addEventListener('scroll', () => {
      requestAnimationFrame(updateProgress);
    });

    // è¿”å›é¡¶éƒ¨åŠŸèƒ½
    window.scrollToTop = () => {
      window.scrollTo({
        top: 0,
        behavior: 'smooth'
      });
    };

    // åˆå§‹åŒ–
    updateProgress();

    // é¡µé¢ç¦»å¼€æ—¶è®°å½•é˜…è¯»æ—¶é—´
    window.addEventListener('beforeunload', () => {
      const elapsed = Math.floor((Date.now() - startTime) / 1000);
      console.log(`é˜…è¯»æ—¶é•¿: ${elapsed}ç§’ï¼Œå·²è¯»ç« èŠ‚: ${readSections.size}/${sections.length}`);
    });
  </script>
</body>

</html>
