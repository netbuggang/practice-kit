<!DOCTYPE html>
<html lang="zh-CN">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>åœºæ™¯2ï¼šæ— é™æ»šåŠ¨ | IntersectionObserver</title>
  <link rel="stylesheet" href="../css/style.css">
  <style>
    .scroll-container {
      height: 500px;
      overflow-y: auto;
      border: 2px solid #e2e8f0;
      border-radius: 12px;
      padding: 1rem;
      background: #f8fafc;
    }

    .item-card {
      background: white;
      padding: 1.2rem;
      margin-bottom: 1rem;
      border-radius: 8px;
      box-shadow: 0 2px 8px rgba(0, 0, 0, 0.05);
      border-left: 4px solid #667eea;
      animation: fadeIn 0.3s;
    }

    @keyframes fadeIn {
      from {
        opacity: 0;
        transform: translateY(10px);
      }

      to {
        opacity: 1;
        transform: translateY(0);
      }
    }

    .sentinel {
      height: 40px;
      margin: 10px 0;
      display: flex;
      align-items: center;
      justify-content: center;
      color: #64748b;
      font-size: 0.9rem;
    }

    .loading {
      display: inline-block;
      width: 20px;
      height: 20px;
      border: 2px solid #e2e8f0;
      border-top-color: #667eea;
      border-radius: 50%;
      animation: spin 0.8s linear infinite;
      margin-right: 8px;
    }

    @keyframes spin {
      to {
        transform: rotate(360deg);
      }
    }

    .stats {
      background: #f1f5f9;
      padding: 1rem;
      border-radius: 8px;
      margin-bottom: 1rem;
      font-size: 0.95rem;
    }
  </style>
</head>

<body>
  <div class="page-header">
    <a href="../index.html" class="back-link">â† è¿”å›ä¸»é¡µ</a>
    <h1>â™¾ï¸ åœºæ™¯2ï¼šæ— é™æ»šåŠ¨</h1>
    <div style="width: 80px;"></div>
  </div>

  <div class="demo-container">
    <div class="explain">
      <strong>ğŸ’¡ åŸç†ï¼š</strong> åœ¨åˆ—è¡¨åº•éƒ¨æ”¾ç½®ä¸€ä¸ªå“¨å…µå…ƒç´ ï¼ˆsentinelï¼‰ã€‚
      å½“å“¨å…µè¿›å…¥è§†å£æ—¶ï¼Œè§¦å‘åŠ è½½æ›´å¤šæ•°æ®çš„æ“ä½œï¼Œå®ç°æ— é™æ»šåŠ¨ã€‚
    </div>

    <div class="stats">
      <span id="itemCount">å½“å‰åŠ è½½äº† 10 é¡¹</span>
    </div>

    <div class="scroll-container" id="scrollContainer">
      <div id="itemList"></div>
      <div class="sentinel" id="sentinel">
        <span class="loading"></span> åŠ è½½æ›´å¤šä¸­...
      </div>
    </div>
  </div>

  <script>
    let currentPage = 1;
    let isLoading = false;
    let hasMore = true;
    const pageSize = 10;

    // æ¨¡æ‹ŸAPIè¯·æ±‚
    async function fetchItems(page) {
      return new Promise(resolve => {
        setTimeout(() => {
          const items = Array.from({ length: pageSize }, (_, i) => ({
            id: (page - 1) * pageSize + i + 1,
            title: `ç¬¬ ${page} é¡µ - é¡¹ç›® ${i + 1}`,
            content: `è¿™æ˜¯ç¬¬ ${(page - 1) * pageSize + i + 1} æ¡æ•°æ®çš„å†…å®¹æè¿°ã€‚`
          }));
          resolve(items);
        }, 800); // æ¨¡æ‹Ÿç½‘ç»œå»¶è¿Ÿ
      });
    }

    // æ¸²æŸ“åˆ—è¡¨
    function renderItems(items) {
      const list = document.getElementById('itemList');
      items.forEach(item => {
        const div = document.createElement('div');
        div.className = 'item-card';
        div.innerHTML = `
                    <h4>${item.title}</h4>
                    <p style="color: #64748b; margin-top: 0.5rem;">${item.content}</p>
                    <small style="color: #94a3b8;">ID: ${item.id}</small>
                `;
        list.appendChild(div);
      });

      document.getElementById('itemCount').textContent =
        `å½“å‰åŠ è½½äº† ${list.children.length} é¡¹`;
    }

    // åŠ è½½æ›´å¤šæ•°æ®
    async function loadMore() {
      if (isLoading || !hasMore) return;

      isLoading = true;
      const sentinel = document.getElementById('sentinel');
      sentinel.style.opacity = '1';

      try {
        const newItems = await fetchItems(currentPage);

        if (newItems.length < pageSize) {
          hasMore = false;
          sentinel.innerHTML = 'ğŸ‰ å·²ç»åˆ°åº•äº†';
        }

        renderItems(newItems);
        currentPage++;
      } catch (error) {
        console.error('åŠ è½½å¤±è´¥:', error);
        sentinel.innerHTML = 'âŒ åŠ è½½å¤±è´¥ï¼Œè¯·é‡è¯•';
      } finally {
        isLoading = false;

        if (hasMore) {
          sentinel.innerHTML = '<span class="loading"></span> åŠ è½½æ›´å¤šä¸­...';
        }
      }
    }

    // åˆå§‹åŒ–åŠ è½½ç¬¬ä¸€é¡µ
    loadMore();

    // IntersectionObserver å®ç°
    const observer = new IntersectionObserver((entries) => {
      entries.forEach(entry => {
        if (entry.isIntersecting && hasMore && !isLoading) {
          loadMore();
        }
      });
    }, {
      root: document.getElementById('scrollContainer'),
      threshold: 0.1
    });

    // è§‚å¯Ÿå“¨å…µå…ƒç´ 
    observer.observe(document.getElementById('sentinel'));
  </script>
</body>

</html>
